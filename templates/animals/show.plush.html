<div class="py-4 mb-2">
  <h3 class="d-inline-block">Animal number <%= animal.ID %></h3>

  <div class="float-right">
    <%= linkTo(animalsPath(), {class: "btn btn-info"}) { %>
      Back to all Animals
    <% } %>
    <%= linkTo(editAnimalPath({ animal_id: animal.ID }), {id: "editButton", class: "btn btn-warning", title: "Edit", body: "<i class='fa fa-edit'></i>"}) %>
    <%= if (current_user.Admin) {%>
    <%= linkTo(animalPath({ animal_id: animal.ID }), {class: "btn btn-danger", "data-method": "DELETE", "data-confirm": "Are you sure?", title: "Destroy", body: "<i class='fa fa-trash'></i>", style:"width:44px"}) %>
    <% } %>
  </div>
</div>



<nav>
  <div class="nav nav-tabs" id="nav-tab" role="tablist">
    <a class="nav-item nav-link active" id="nav-general-tab" data-toggle="tab" href="#nav-general" role="tab" aria-controls="nav-general" aria-selected="true">General</a>
    <a class="nav-item nav-link" id="nav-discovery-tab" data-toggle="tab" href="#nav-discovery" role="tab" aria-controls="nav-discovery" aria-selected="false">Discovery</a>
    <a class="nav-item nav-link" id="nav-intake-tab" data-toggle="tab" href="#nav-intake" role="tab" aria-controls="nav-intake" aria-selected="false">Intake</a>
    <a class="nav-item nav-link" id="nav-care-tab" data-toggle="tab" href="#nav-care" role="tab" aria-controls="nav-care" aria-selected="false">Care</a>
    <a class="nav-item nav-link" id="nav-vet-tab" data-toggle="tab" href="#nav-vet" role="tab" aria-controls="nav-vet" aria-selected="false">Veterinary</a>
    <a class="nav-item nav-link" id="nav-treatment-tab" data-toggle="tab" href="#nav-treatment" role="tab" aria-controls="nav-treatment" aria-selected="false">Treatment</a>

    <%= if (animal.OuttakeID.Value() != nil ) {%>
      <a class="nav-item nav-link" id="nav-outtake-tab" data-toggle="tab" href="#nav-outtake" role="tab" aria-controls="nav-outtake" aria-selected="false">Outtake</a>
    <% } %>
  </div>
</nav>
<div class="tab-content" id="nav-tabContent">
  <div class="tab-pane fade show active" id="nav-general" role="tabpanel" aria-labelledby="nav-general-tab">
    <ul class="list-group mb-2 ">
      <li class="list-group-item pb-1">
        <label class="small d-block">Number</label>
        <p class="d-inline-block"><%= animal.ID %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Species</label>
        <p class="d-inline-block"><%= animal.Species %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Cage</label>
        <p class="d-inline-block"><%= animal.Cage %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Ring</label>
        <p class="d-inline-block"><%= animal.Ring %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Type</label>
        <p class="d-inline-block"><%= animal.Animaltype.Name %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Age</label>
        <p class="d-inline-block"><%= animal.Animalage.Name %></p>
      </li>
    </ul>
  </div>


  <div class="tab-pane fade" id="nav-discovery" role="tabpanel" aria-labelledby="nav-discovery-tab">
      <ul class="list-group mb-2 ">
        <li class="list-group-item pb-1">
          <label class="small d-block">Location</label>
          <p class="d-inline-block"><%= animal.Discovery.Location %></p>
        </li>
        <li class="list-group-item pb-1">
          <label class="small d-block">Date</label>
          <p class="d-inline-block"><%= animal.Discovery.DateFormated() %></p>
        </li>
        <%= if ( len(animal.Discovery.Reason.Value()) > 0 ) {%>
        <li class="list-group-item pb-1">
          <label class="small d-block">Reason</label>
          <p class="d-inline-block"><%= animal.Discovery.Reason %></p>
        </li>
        <% } %>
        <%= if ( len(animal.Discovery.Note.Value()) > 0 ) {%>
        <li class="list-group-item pb-1">
          <label class="small d-block">Note</label>
          <p class="d-inline-block"><%= animal.Discovery.Note %></p>
        </li>
        <% } %>
      </ul>
      <a class="btn btn-primary" data-toggle="collapse" href="#Discoverer" role="button" aria-expanded="false" aria-controls="collapseDiscoverer">
        Discoverer
      </a>
      <div class="collapse" id="Discoverer">
                          
        <ul class="list-group mb-2 ">
          <li class="list-group-item pb-1">
            <label class="small d-block">Name</label>
            <p class="d-inline-block"><%= animal.Discovery.Discoverer.Firstname %></p>
            <p class="d-inline-block"><%= animal.Discovery.Discoverer.Lastname %></p>
          </li>
          <li class="list-group-item pb-1">
            <label class="small d-block">Address</label>
            <p class="d-inline-block"><%= animal.Discovery.Discoverer.Address %></p>
            <br/>
            <p class="d-inline-block"><%= animal.Discovery.Discoverer.City %></p>
            <br/>
            <p class="d-inline-block"><%= animal.Discovery.Discoverer.Country %></p>
          </li>
          <li class="list-group-item pb-1">
            <label class="small d-block">Contacts</label>
            <%= if ( len(animal.Discovery.Discoverer.Email.Value()) > 0 ) {%>
            <p class="d-inline-block"><i class="far fa-envelope"></i><%= animal.Discovery.Discoverer.Email %></p>
            <% } %>
            <br/>
            <%= if ( len(animal.Discovery.Discoverer.Phone.Value()) > 0 ) {%>
            <p class="d-inline-block"><i class="fas fa-phone-square"></i><%= animal.Discovery.Discoverer.Phone %></p>
            <% } %>
          </li>
        </ul>
      </div>
  </div>
  
  <div class="tab-pane fade" id="nav-intake" role="tabpanel" aria-labelledby="nav-intake-tab">
    <ul class="list-group mb-2 ">
      <li class="list-group-item pb-1">
          <label class="small d-block">Date</label>
          <p class="d-inline-block"><%= animal.Discovery.DateFormated() %></p>
      </li>

      <li class="list-group-item pb-1">
        <label class="small d-block">General</label>
        <p class="d-inline-block"><%= animal.Intake.General %></p>
      </li>

      <li class="list-group-item pb-1">
        <label class="small d-block">Wounds</label>
        <p class="d-inline-block"><%= animal.Intake.Wounds %></p>
      </li>

      <li class="list-group-item pb-1">
        <label class="small d-block">Parasites</label>
        <p class="d-inline-block"><%= animal.Intake.Parasites %></p>
      </li>

      <li class="list-group-item pb-1">
        <label class="small d-block">Remarks</label>
        <p class="d-inline-block"><%= animal.Intake.Remarks %></p>
      </li>
    </ul>
  </div>
  
  <div class="tab-pane fade" id="nav-care" role="tabpanel" aria-labelledby="nav-care-tab">
    <%= if (animal.Feeding.Value()) {%>
      <ul class="list-group mb-2 ">
        <li class="list-group-item pb-1">
          <label class="small d-block">Feeding</label>
          <p class="d-inline-block"><%= animal.Feeding %></p>
        </li>
      </ul>
    <% } %>
    <div class="py-4 mb-2">
      <div class="float-right">
        <%= linkTo(newCaresPath({animal_id: animal.ID, back: "/animals/"+animal.ID.String()+"#nav-care"}), {class: "btn btn-primary"}) { %>
          Create New Care
        <% } %>
      </div>
    </div>
    <table class="table table-hover table-bordered">
      <thead class="thead-light">
        <th>Date</th>
        <th>Weight</th>
        <th>Note</th>
        <th><i class="fa fa-soap" aria-hidden="true"></i></th>
        <th>Type</th>
        <th>&nbsp;</th>
      </thead>
      <tbody>
        <%= for (care) in animal.Cares { %>
          <tr>
            <td class="align-middle"><%= care.Date.DateFormated() %></td>
            <td class="align-middle"><%= care.Weight %></td>
            <td class="align-middle"><%= care.Note %></td>
            <td class="align-middle">
              <%= if (care.Clean.Value()==true) { %>
                <i class="fa fa-check" aria-hidden="true"></i>
              <% } %>
            </td>
            <td class="align-middle"><%= care.Type.Name %></td>
            <td>
              <div class="float-right">
                <%= linkTo(carePath({ care_id: care.ID, back: "/animals/"+animal.ID.String()+"#nav-care" }), {class: "btn btn-info", title: "View", body:"<i class='fa fa-eye'></i>"}) %>
                <%= linkTo(editCarePath({ care_id: care.ID, back: "/animals/"+animal.ID.String()+"#nav-care" }), {class: "btn btn-warning", title: "Edit", body:"<i class='fa fa-edit'></i>"}) %>
                <%= if (current_user.Admin) {%>
                <%= linkTo(carePath({ care_id: care.ID, back: "/animals/"+animal.ID.String()+"#nav-care"}), {class: "btn btn-danger", "data-method": "DELETE", "data-confirm": "Are you sure?", title: "Destroy", body:"<i class='fa fa-trash'></i>", style:"width:44px"}) %>
                <% }%>
              </div>
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane fade" id="nav-vet" role="tabpanel" aria-labelledby="nav-vet-tab">
    <div class="py-4 mb-2">
      <h3 class="d-inline-block">Veterinary visits</h3>
      <div class="float-right">
        <%= linkTo(newVeterinaryvisitsPath({animal_id: animal.ID, back: "/animals/"+animal.ID.String()+"#nav-vet" }), {class: "btn btn-primary"}) { %>
          Create New Veterinary visit
        <% } %>
      </div>
    </div>

    <table class="table table-hover table-bordered">
      <thead class="thead-light">
        <th>Date</th>
        <th>Veterinary</th>
        <th>User</th>
        <th>Diagnostic</th>
        <th>&nbsp;</th>
      </thead>
      <tbody>
        <%= for (veterinaryvisit) in animal.VetVisits{ %>
          <tr>
            <td class="align-middle"><%= veterinaryvisit.Date.Formated() %></td>
            <td class="align-middle"><%= veterinaryvisit.Veterinary %></td>
            <td class="align-middle"><%= veterinaryvisit.User.Email %></td>
            <td class="align-middle"><%= veterinaryvisit.Diagnostic %></td>
            <td>
              <div class="float-right">
                <%= linkTo(veterinaryvisitPath({ veterinaryvisit_id: veterinaryvisit.ID,  back: "/animals/"+animal.ID.String()+"#nav-vet" }), {class: "btn btn-info", title: "View", body:"<i class='fa fa-eye'></i>"}) %>
                <%= linkTo(editVeterinaryvisitPath({ veterinaryvisit_id: veterinaryvisit.ID,  back: "/animals/"+animal.ID.String()+"#nav-vet" }), {class: "btn btn-warning", title: "Edit", body:"<i class='fa fa-edit'></i>"}) %>
                <%= if (current_user.Admin) {%>
                <%= linkTo(veterinaryvisitPath({ veterinaryvisit_id: veterinaryvisit.ID,  back: "/animals/"+animal.ID.String()+"#nav-vet" }), {class: "btn btn-danger", "data-method": "DELETE", "data-confirm": "Are you sure?", title: "Destroy", body:"<i class='fa fa-trash'></i>", style:"width:44px"}) %>
                <%  }%>
              </div>
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane fade" id="nav-treatment" role="tabpanel" aria-labelledby="nav-treatment-tab">
      <h1>Treatment TBD</h1>
  </div>

  <%= if (animal.OuttakeID.Value() != nil) {%>
  <div class="tab-pane fade" id="nav-outtake" role="tabpanel" aria-labelledby="nav-outtake-tab">
    <ul class="list-group mb-2 ">
      <li class="list-group-item pb-1">
        <label class="small d-block">Date</label>
        <p class="d-inline-block"><%= animal.Outtake.Date %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Type</label>
        <p class="d-inline-block"><%= animal.Outtake.Type.Name %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Location</label>
        <p class="d-inline-block"><%= animal.Outtake.Location %></p>
      </li>
      <li class="list-group-item pb-1">
        <label class="small d-block">Note</label>
        <p class="d-inline-block"><%= animal.Outtake.Note %></p>
      </li>
    </ul>
  </div>
  <% } %>


</div>
<script>
$(".nav-tabs").find("a").first().click();

var url = document.URL;
var hash = url.substring(url.indexOf('#'));
var editPath = "<%= editAnimalPath({ animal_id: animal.ID }) %>";
if (url.indexOf('#') > 0) {
  $("#editButton").attr("href", editPath+hash);
}

$(".nav-tabs").find("a").each(function(key, val) {
  if (hash == $(val).attr('href')) {
    $(val).click();
  }
  $(val).click(function(ky, vl) {
    console.log($(this).attr('href'));
    location.hash = $(this).attr('href');
    $("#editButton").attr("href", editPath+location.hash);
  });
});
</script>
