<%= if (treatmentTemplate.AnimalID.Value() == 0 ) { %>
  <div class="py-4 mb-2">
    <div class="float-right">
    <%= linkTo(treatmentsPath(), {class: "btn btn-info"}) { %>
          See all treatments
    <% } %>
    </div>
  </div>
  <h4>Select animal for treatment</h4>
  <%= formFor(treatmentTemplate, {action: newTreatmentsPath(), method: "GET"}) { %>
  <div class="form-group row">
    <label for="animalID" class="col-sm-2 col-form-label">Animal ID</label>
    <div class="col-sm-10">
      <input type="number" class="form-control" id="animal_id" name="animal_id" placeholder="123" required>
      <script>
        $('input[name="animal_id"]').autoComplete({
            minChars: 0,
            source: function(term, response){
                $.getJSON('/suggestions/animal_in_care', { q: term }, function(data){ response(data); });
            }
        });
      </script>
    </div>
  </div>
  <div class="form-group row">
    <button class="btn btn-success" role="submit">Next</button>
  </div>
  <% } %>
<% } else { %>
<div class="py-4 mb-2">
  <h3 class="d-inline-block">New Treatment for animal <%= treatmentTemplate.AnimalID %></h3>
</div>


<% 
  let data = {}
  if (params["back"]) { 
    data = { back: params["back"] }
  }
%>

<%= formFor(treatmentTemplate, {action: treatmentsPath( data ), method: "POST"}) { %>
  <input type="hidden" name="AnimalID" value="<%= treatmentTemplate.AnimalID %>" />
  <div class="container p-3 my-3 border">
        <div class="form-row">
          <div class="form-group col-md-12">
              <label>Date from</label>
              <div class="input-group md-12">
                  <input class=" form-control" id="dtf" name="DateFrom" required="required" type="text" value="<%= treatmentTemplate.DateFromFormated() %>">
                  <div class="input-group-append">
                      <div class="input-group-text">
                          <i class="fa fa-calendar" aria-hidden="true"></i>
                      </div>
                  </div>
              </div>
          </div>
          <script type="text/javascript">
              $('#dtf').datetimepicker({
                timepicker:false,
                format:'Y/m/d'
              });
          </script>
        </div>

        <div class="form-row">
          <div class="form-group col-md-12">
              <label>Date to</label>
              <div class="input-group md-12">
                  <input class=" form-control" id="dtt" name="DateTo" required="required" type="text" value="<%= treatmentTemplate.DateToFormated() %>">
                  <div class="input-group-append">
                      <div class="input-group-text">
                          <i class="fa fa-calendar" aria-hidden="true"></i>
                      </div>
                  </div>
              </div>
          </div>
          <script type="text/javascript">
              $('#dtt').datetimepicker({
                timepicker:false,
                format:'Y/m/d'
              });
          </script>
        </div>

        <div class="form-row">
          <div class="form-group col-md-12">
          <label>Schedule</label>
          <div class="border p-3">
            <%= f.CheckboxTag("Morning") %>
            <%= f.CheckboxTag("Noon") %>
            <%= f.CheckboxTag("Evening") %>
          </div>
        </div>

        <%= f.InputTag("Drug", {required:"required", bootstrap:{form-group-class:"form-group col-md-12"}})%>
        <script>
          $('input[name="Drug"]').autoComplete({
              minChars: 1,
              source: function(term, response){
                  $.getJSON('/suggestions/treatment_drug', { q: term }, function(data){ response(data); });
              }
          });
        </script>
        <%= f.InputTag("Dosage", { required:"required", bootstrap:{form-group-class:"form-group col-md-12"}})%>

        <%= f.TextAreaTag("Remarks", {rows: 10, bootstrap:{form-group-class:"form-group col-md-12"}}) %>
    </div>
  
  <button class="btn btn-success" role="submit">Save</button>

  
  <%= if (params["back"]) { %>
  <%= linkTo(params["back"], {class: "btn btn-warning", "data-confirm": "Are you sure?", body: "Cancel"}) %>
  <% } else { %>
  <%= linkTo(treatmentsPath(), {class: "btn btn-warning", "data-confirm": "Are you sure?", body: "Cancel"}) %>
  <% } %>
<% } %>
<% } %>